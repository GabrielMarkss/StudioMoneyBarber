<!-- NAVBAR SUPERIOR -->
<nav class="navbar" id="navbar">
  <div class="left" style="display: flex; align-items: center">
    <img
      src="assets/user-profile.png"
      alt="Perfil"
      routerLink="/dashteste"
      class="profile-img"
      style="width: 85px; height: 85px; border-radius: 50%; cursor: pointer" />
    <div class="greeting">
      <div>Ol√°, {{ usuarioService.nomeUsuario || "..." }}</div>
      <small>{{ dataHoje }}</small>
    </div>
  </div>

  <div
    class="right"
    style="
      display: flex;
      align-items: flex-end;
      gap: 0.5rem;
      padding-bottom: 0.25px;
      margin-top: 20px;
    ">
    <!-- √çcone Notifica√ß√£o com pop-up -->
    <div
      class="notificacao-wrapper"
      (mouseenter)="abrirNotificacao()"
      (mouseleave)="fecharNotificacao()"
      style="margin-right: 0.625rem">
      <img
        src="assets/notificacao.png"
        alt="Notifica√ß√µes"
        class="notificacao"
        style="width: 2.25rem; cursor: pointer; transform: translateY(2px)" />

      <!-- Pop-up din√¢mico -->
      <div class="notificacao-popup" *ngIf="mostrarNotificacoes">
        <div *ngFor="let n of notificacoes" class="notificacao-card">
          <div class="notificacao-imagem">
            <img
              [src]="n.imagemUrl"
              alt="Imagem"
              style="width: 100%; height: 100%" />
          </div>
          <div class="notificacao-conteudo">
            <strong>{{ n.titulo }}</strong>
            <small>{{ n.descricao }}</small>
          </div>
          <div
            *ngIf="usuarioService.usuarioEhAdmin()"
            style="
              display: flex;
              align-items: center;
              gap: 0.3rem;
              margin-left: auto;
            ">
            <span
              class="icone-acao editar notificacao"
              title="Editar notifica√ß√£o"
              style="font-size: 17px"
              (click)="editarNotificacao(n)">‚úé</span>

            <span
              class="icone-acao apagar notificacao"
              title="Remover notifica√ß√£o"
              style="font-weight: bold"
              (click)="confirmarRemocao(n)">‚úï</span>
          </div>
        </div>

        <div
          class="nova-notificacao"
          *ngIf="usuarioService.usuarioEhAdmin()"
          (click)="abrirFormularioNotificacao()">
          + Nova notifica√ß√£o
        </div>
      </div>

      <!-- Formul√°rio de cria√ß√£o (modal) -->
      <div
        class="formulario-modal"
        *ngIf="mostrarFormulario && usuarioService.usuarioEhAdmin()">
        <h3 style="color: black; margin-top: 0">Nova Notifica√ß√£o</h3>

        <input
          type="text"
          [(ngModel)]="nova.titulo"
          class="form-control"
          placeholder="T√≠tulo da notifica√ß√£o"
          style="width: 100%" />
        <textarea
          [(ngModel)]="nova.descricao"
          class="form-control"
          placeholder="Descri√ß√£o da notifica√ß√£o"
          style="width: 100%; resize: none"
          rows="3"></textarea>

        <input
          style="color: black"
          type="file"
          (change)="onFileChange($event)" />

        <div class="botoes-container">
          <button class="cancelar" (click)="cancelarFormulario()">
            Cancelar
          </button>
          <button
            class="salvar"
            (click)="salvarNotificacao()"
            [disabled]="
              !nova.titulo.trim() || !nova.descricao.trim() || !nova.imagemUrl
            ">
            Salvar
          </button>
        </div>
      </div>
    </div>

    <!-- Bot√£o de menu ‚ò∞ -->
    <div
      class="dropdown"
      (mouseenter)="abrirMenu()"
      (mouseleave)="fecharMenu()">
      <div class="dropdown-toggle">‚ò∞</div>
      <ul class="dropdown-menu" *ngIf="menuAberto">
        <li><a routerLink="/menu">Perfil</a></li>
        <li><a routerLink="/galeria">Galeria</a></li>
        <li><a routerLink="/produtos">Produtos</a></li>
        <li><a routerLink="/agendamentos">Agendamentos</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- ===== CONTAINER DE SERVI√áOS E HOR√ÅRIOS ===== -->
<div class="agendamento-container">
  <!-- ===== SERVI√áOS ===== -->
  <div class="servicos-box">
    <h3>Selecione os Servi√ßos:</h3>
    <div class="servicos-lista">
      <div *ngFor="let servico of servicos" class="servico-item">
        <label>
          <input
            type="checkbox"
            [value]="servico.id"
            (change)="toggleServico(servico.id!, $event)"
            [checked]="servicosSelecionados.includes(servico.id!)" />
          {{ servico.nome }}
        </label>
        <span class="preco-servico">R$ {{ servico.preco | number : "1.2-2"
          }}</span>
      </div>
    </div>
  </div>

  <!-- ===== HOR√ÅRIOS E RESUMO ===== -->
  <div class="horarios-box">
    <!-- ===== HOR√ÅRIOS DISPON√çVEIS ===== -->
    <div class="horarios-disponiveis">
      <h2>Horarios Dispon√≠veis - Felipe</h2>

      <!-- A√á√ïES ADMIN -->
      <div *ngIf="usuarioService.usuarioEhAdmin()" class="acoes-admin">
        <button
          title="Criar hor√°rio"
          (click)="abrirFormularioCriarHorario()"
          class="btn-acao-admin">
          Criar hor√°rio
        </button>
        <button
          title="Bloquear dia"
          (click)="toggleBloquearDiaSelecionado()"
          class="btn-acao-admin">
          Bloquear dia
        </button>
      </div>

      <!-- SELE√á√ÉO DE DIA -->
      <div class="dias-wrapper">
        <button *ngFor="let d of diasSemana"
          [class.ativo]="diaSelecionado === d.value"
          (click)="selecionarDia(d.value)">
          {{ d.label }}
        </button>
      </div>
      <!-- PER√çODO MANH√É -->
      <div class="periodo">
        <h4>
          Manh√£
          <button class="delete-mode-btn" (click)="modoRemocao = !modoRemocao"
            title="Ativar modo de remo√ß√£o">
            üóëÔ∏è
          </button>
        </h4>
        <div class="horarios">
          <div
            *ngFor="let h of horariosManha"
            [class.bloqueado]="h.bloqueado || horarioJaPassou(h.horario)"
            [class.remocao-ativa]="modoRemocao"
            class="horario-box"
            (click)="modoRemocao ? confirmarRemoverHorario(h) : null"
            (mouseenter)="hoverHorarioId = h.id"
            (mouseleave)="hoverHorarioId = null">

            {{ h.horario | horarioFormat }}

            <div
              class="acoes-mini"
              *ngIf="usuarioService.usuarioEhAdmin() && !modoRemocao && !horarioJaPassou(h.horario)"
              [style.display]="hoverHorarioId === (h.id ?? null) ? 'block' : 'none'">
              <button (click)="abrirAcaoHorario(h)">‚ãÆ</button>
            </div>
          </div>

        </div>
      </div>

      <!-- PER√çODO TARDE -->
      <div class="periodo">
        <h4>
          Tarde
          <button class="delete-mode-btn" (click)="modoRemocao = !modoRemocao"
            title="Ativar modo de remo√ß√£o">
            üóëÔ∏è
          </button>
        </h4>
        <div class="horarios">
          <div
            *ngFor="let h of horariosTarde"
            [class.bloqueado]="h.bloqueado || horarioJaPassou(h.horario)"
            [class.remocao-ativa]="modoRemocao"
            class="horario-box"
            (click)="modoRemocao ? confirmarRemoverHorario(h) : null"
            (mouseenter)="hoverHorarioId = h.id"
            (mouseleave)="hoverHorarioId = null">
            {{ h.horario | horarioFormat }}

            <div
              class="acoes-mini"
              *ngIf="usuarioService.usuarioEhAdmin() && !modoRemocao && !horarioJaPassou(h.horario)"
              [style.display]="hoverHorarioId === (h.id ?? null) ? 'block' : 'none'">
              <button (click)="abrirAcaoHorario(h)">‚ãÆ</button>
            </div>
          </div>
        </div>
      </div>

      <!-- PER√çODO NOITE -->
      <div class="periodo">
        <h4>
          Noite
          <button class="delete-mode-btn" (click)="modoRemocao = !modoRemocao"
            title="Ativar modo de remo√ß√£o">
            üóëÔ∏è
          </button>
        </h4>
        <div class="horarios">
          <div
            *ngFor="let h of horariosNoite"
            [class.bloqueado]="h.bloqueado || horarioJaPassou(h.horario)"
            [class.remocao-ativa]="modoRemocao"
            class="horario-box"
            (click)="modoRemocao ? confirmarRemoverHorario(h) : null"
            (mouseenter)="hoverHorarioId = h.id"
            (mouseleave)="hoverHorarioId = null">
            {{ h.horario | horarioFormat }}

            <div
              class="acoes-mini"
              *ngIf="usuarioService.usuarioEhAdmin() && !modoRemocao && !horarioJaPassou(h.horario)"
              [style.display]="hoverHorarioId === (h.id ?? null) ? 'block' : 'none'">
              <button (click)="abrirAcaoHorario(h)">‚ãÆ</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ===== RESUMO DO AGENDAMENTO ===== -->
      <div class="resumo-agendamento">
        <div class="informacoes-box">
          <h3>Resumo do Agendamento</h3>

          <div class="resumo-item">
            <strong>Barbeiro Selecionado:</strong>
            <span>{{ barbeiroSelecionado?.nome || "Nenhum selecionado" }}</span>
          </div>

          <div class="resumo-item">
            <label for="cupom"><strong>Aplicar Cupom:</strong></label>
            <select
              id="cupom"
              [(ngModel)]="cupomSelecionadoId"
              (change)="onCupomChange()">
              <option [value]="''">Nenhum</option>
              <option *ngFor="let c of cuponsDisponiveis" [value]="c.id">
                {{ c.nome }} - {{ c.desconto }}%
              </option>
            </select>
          </div>

          <div class="resumo-item">
            <strong>Valor Total:</strong>
            R$ {{ valorTotal | number : "1.2-2" }}
          </div>

          <div class="resumo-item">
            <strong>Desconto:</strong>
            <span *ngIf="descontoAplicado > 0">- R$ {{ descontoAplicado | number
              :
              "1.2-2" }}</span>
            <span *ngIf="descontoAplicado === 0">R$ 0.00</span>
          </div>

          <div class="resumo-item">
            <strong>Valor Final:</strong>
            <span style="color: #f46d25; font-weight: bold">R$ {{ valorFinal |
              number : "1.2-2" }}</span>
          </div>

          <button class="confirmar-btn" (click)="confirmarAgendamento()">
            Confirmar Agendamento
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- ===== FORMUL√ÅRIO DE ADICIONAR/EDITAR HOR√ÅRIO ===== -->
  <div
    *ngIf="mostrarFormularioHorario"
    class="formulario-modal"
    style="
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 12px;
      z-index: 999;
      width: 320px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    ">
    <h3 style="margin-top: 0; color: black">
      {{ horarioParaEditar ? 'Editar Hor√°rio' : 'Novo Hor√°rio' }}
    </h3>

    <label for="horarioInput" style="color: black">Hor√°rio:</label>
    <input
      id="horarioInput"
      type="time"
      [(ngModel)]="horarioParaEditar!.horario"
      style="width: 100%; margin-bottom: 1rem" />

    <div style="display: flex; justify-content: flex-end; gap: 10px">
      <button (click)="cancelarEdicaoHorario()">Cancelar</button>
      <button
        (click)="salvarHorario()"
        [disabled]="!horarioParaEditar?.horario">
        Salvar
      </button>
    </div>
  </div>

  <!-- BARRA INFERIOR MOBILE -->
  <div class="bottom-nav">
    <a routerLink="/dashboard" class="nav-item">
      <img
        src="assets/home-ativa.png"
        alt="In√≠cio"
        width="38px"
        height="32px" />
      <span style="color: #f46d25; font-weight: bold">In√≠cio</span>
    </a>
    <a routerLink="/galeria" class="nav-item">
      <img src="assets/galeria.png" alt="Galeria" width="34px" height="33px" />
      <span>Galeria</span>
    </a>
    <a routerLink="/agendamentos" class="nav-item">
      <img
        src="assets/agendamento.png"
        alt="Agendamentos"
        width="34px"
        height="34px" />
      <span>Agendamentos</span>
    </a>
    <a routerLink="/produtos" class="nav-item">
      <img src="assets/produto.png" alt="Produtos" width="30px" height="30px" />
      <span>Produtos</span>
    </a>
    <a routerLink="/menu" class="nav-item">
      <img
        src="assets/user-profile.png"
        alt="Menu"
        width="40px"
        height="40px" />
      <span>Menu</span>
    </a>
  </div>
</div>
